-*- mode: org; fill-column:70 -*-

* Org-mode::org-fold branch

This branch is a re-implementation of Org-mode folding mechanism. This should help with performance on large files.

The old mechanism is using [[https://www.gnu.org/software/emacs/manual/html_node/elisp/Overlays.html#Overlays][overlays]], which are implemented with O(n) complexity in Emacs. It means that any attempt to move through hidden text in large org file will require time scaling with the number of drawers/folded subtrees. More details in my old [[https://lists.gnu.org/archive/html/bug-gnu-emacs/2019-04/msg01387.html][bug report]].

This branch is hiding text using [[https://www.gnu.org/software/emacs/manual/html_node/elisp/Text-Properties.html#Text-Properties][text properties]] instead of overlays. Text properties are much faster (just O(logN)). The effect should be noticeable in org files with more than ~1000 hidden elements (drawers or high-level headlines). More details about this branch development can be found in the Org-mode mailing list discussion thread: https://orgmode.org/list/87h7x9e5jo.fsf@localhost/. If one wants to know even more details, I tried my best to document all the logic in the comments of [[file:./lisp/org-fold.el]].

This repository is aiming to simplify testing of the branch. Feel free to open issues if you find bugs.

 *Important*: I cannot accept all the pull requests to avoid copyright issues. Only people finished FSF copyright assignment can contribute to this branch. See [[https://orgmode.org/contribute.html][Org mode contribution instructions]] for details.

* Installation

** Using [[https://github.com/hlissner/doom-emacs/][Doom Emacs]]

Credit: https://old.reddit.com/r/orgmode/comments/k6f5fx/ann_experimental_orgmode_branch_improving/genltoj/
#+begin_src emacs-lisp
;; ~/.doom.d/packages.el
(package! org-mode
  :recipe (:host github
           :repo "yantar92/org"
           :branch "feature/org-fold"
           :files ("*.el" "lisp/*.el" "contrib/lisp/*.el")
           :build (with-temp-file (expand-file-name "org-version.el" (straight--repos-dir "org"))
                    (insert "(fset 'org-release (lambda () \"9.5\"))\n"
                            "(fset 'org-git-version #'ignore)\n"
                            "(provide 'org-version)\n")))
  :pin "308c4f57d26307c0f57ad387a4638b051f541a9c"
  :shadow 'org)
#+end_src

Thanks to [[https://old.reddit.com/user/AloisJanicek][AloisJanicek]] for the code snippet.

** Using [[https://github.com/raxod502/straight.el/][Straight.el]]

#+begin_src emacs-lisp
;; Should be placed inside init.el before anything loading org-mode 
(straight-use-package '(org :host github :repo "yantar92/org" :branch "feature/org-fold"
			    :files (:defaults "contrib/lisp/*.el")))
#+end_src

** Manual installation

Quoting [[https://orgmode.org/org.html#Installation][original org-mode installation instructions]], but for this repo:

You can clone Org’s repository and install Org like this:

#+begin_src bash
cd ~/src/
git clone https://github.com/yantar92/org
cd org-mode/
make autoloads
#+end_src

Note that in this case, ‘make autoloads’ is mandatory: it defines Org’s version in ‘org-version.el’ and Org’s autoloads in ‘org-loaddefs.el’.

Make sure you set the load path correctly in your Emacs init file:

#+begin_src emacs-lisp
(add-to-list 'load-path "~/path/to/orgdir/lisp")
#+end_src

The repository contains contributed libraries that are not included in Emacs. If you want to use them, add the ‘contrib/’ directory to your load path:

#+begin_src emacs-lisp
(add-to-list 'load-path "~/path/to/orgdir/contrib/lisp" t)
#+end_src

You can also compile with ‘make’, generate the documentation with ‘make doc’, create a local configuration with ‘make config’ and install Org with ‘make install’. Please run ‘make help’ to get the list of compilation/installation options.

For more detailed explanations on Org’s build system, please check the Org Build System page on [[https://orgmode.org/worg/dev/org-build-system.html][Worg]].

* Contents of this distribution

- README :: This file.

- COPYING :: The GNU General Public License.

- Makefile :: The makefile to compile and install Org.  For installation
  instructions, see the manual or [[https://orgmode.org/worg/dev/org-build-system.html][the more detailed procedure on Worg]].
  
- mk/ :: Files needed for building Org.

- lisp/ :: Directory with all the Emacs Lisp files that make up Org.

- doc/ :: The documentation files.  org.texi is the source of the
  documentation, org.html and org.pdf are formatted versions of it.

- contrib/ :: A directory with third-party additions for Org.  Some
  really cool stuff is in there.

- etc/ :: Files needed for the ODT exporter.

- testing/ :: Testing suite for Org.

- request-assign-future.txt :: The form that contributors have to sign
  and get processed with the FSF before contributed changes can be
  integrated into the Org core.  All files in this distribution except
  the contrib/ directory have copyright assigned to the FSF.

* License

Org-mode is published under [[https://www.gnu.org/licenses/gpl-3.0.html][the GNU GPLv3 license]] or any later
version, the same as GNU Emacs.  See the COPYING file in this
directory.
